# Нагрузка, стресс и отказоустойчивость

## 1. Что такое нагрузочное тестирование, тестирование отказоустойчивости и стресс-тестирование? Что их отличает друг от друга?   
***Нагрузочное тестирование (Load Testing)***  это проверка того, как работает ваша система под разными уровнями нагрузки до предельного значения, которое она должна выдерживать. Предельное значение должно быть прописано в нефункциональных требованиях по нагрузке. При таком тестировании замеряется время отклика системы и скорость обработки запросов от пользователей (например, как быстро открываются и прогружаются страницы сайта, как быстро система выполняет расчеты, выдает результаты поиска и т.д.), а также сколько ресурсов “съедает” система – сетевых, процессорных, памяти.  
Основная цель нагрузочного тестирования заключается в том, чтобы, создав определенную нагрузку наблюдать за показателями производительности системы. Причем мы сами решаем на какой именно нагрузке проверять, главное, чтобы значение этой нагрузки не превышало значения, указанного в требованиях.  
***Тестирование отказоустойчивости (Failover and Recovery Testing)*** вид тестирования производительности, который позволяет проверить поведение системы в случае сбоя серверов или при других неблагоприятных факторах. Такое тестирование особенно важно в системах, работающих в режиме 24/7, т.к. в случае их выхода из строя возможны потери клиентов, репутации, денег и т.п.

Во время тестирования проверяются следующие операции:

- как будет преодолеваться отказ, а именно как система будет перемещать операции между мощностями работающего и нет оборудования;
- как будет осуществлен перехват управления системой при отказе управляющего сервера;
- как будет осуществлен обход и обработка отказа (переключение на резервный канал связи, отправка данных по другому маршруту и т.д.).

***Стресс- тестирование (Stress Testing)*** оценивает скорость работы системы, если нагрузка на систему выше нормы, описанной в требованиях, или же в состоянии ограниченных ресурсов (память, скорость интернета). Нагрузка при данном виде тестирования может производиться в течение долгого промежутка времени.


## 2. Приведите по одному примеру выполнения каждого из трёх видов тестирования (в контексте проверки базы данных большого веб-приложения).
**Нагрузочное тестирование:**  

Рассмотрим на примере сайта интернет магазина.   

Мы рассчитываем, что наш интернет магазин должен выдержать 5000 пользователей, которые одновременно работают на сайте, причем:   

- 50% пользователей только просматривают товары;  
- 20% пользователей добавляют товар в корзину и уходят;  
- 20% заходят на сайт, но ничего на нем не делают;  
- 10% пользователей покупают товар;  
В данной ситуации время отклика нашего сайта должно составлять не более 5 секунд.

Для проведения такого тестирования эмулируется указанная выше нагрузка и измеряется время отклика.  
 **Стресс-тестирование**  
Пример с вышеуказанным интернет магазином. Стресс - тестирование будет проводиться на более, чем 5000 одновременно работающих пользователях.  

**Тестирование отказоустойчивостим:**

Симуляция внезапного отказа электричества на компьютере (обесточить компьютер).
При достижении соответствующих условий сбоя и по результатам работы систем восстановления, можно оценить продукт с точки зрения тестирования на отказ. По завершении процедур восстановления, должно быть достигнуто определенное требуемое состояние данных продукта:  

- Потеря или порча данных в допустимых пределах.  
- Отчет или система отчетов с указанием процессов или транзакций, которые не были завершены в результате сбоя.  

## 3. С помощью каких инструментов можно провести нагрузочное тестирование базы данных?

**Load Runner**  
Специализированный инструмент от корпорации HP для нагрузочного тестирования, подходит и для стрессового. Работает с т.н. VuGen, то есть генерирует виртуальных пользователей/запросы. Имеются удобные аналитические отчёты, которые можно выводить в виде графиков и диаграмм.   

**Neoload**  
Платный инструмент для тестирования веб- и мобильных приложений. Способен симулировать более тысячи одновременных пользователей, проверяет производительность системы и время ответа сервера. Облачная интеграция как нагрузочного, так и стресс-тестирования. Хорошо масштабируется и довольно простой.   
 
**JMeter**  
С открытым кодом, работающий с JDK 5 и выше. В основном применяется для веб-приложений. Также может тестировать LDAP, FTP, JDBC.   

**Grinder**  
Так же с открытым кодом и тоже Java-based. Можно динамически менять параметры в процессе. Хорошая система репортов и assertions, что помогает в анализе результатов. Есть консоль, которая применяется в качестве IDE для создания и изменения тестов и агентов, регулируя нагрузку.   

**Webload**  
Бесплатный инструмент, имеющий и платную версию. Но в бесплатной версии ограничение до 50 пользователей. Поддерживает и мобильные приложения. Работает со всеми протоколами: http, https, Push, ajax, есть также IDE, консоль генерации нагрузки, панель анализа, и средства интеграции с Jenkins, APM.  

## 4. Какие существуют способы оптимизации (улучшения производительности) базы данных?

**Оптимизация запросов**  

В большинстве случаев проблемы с производительностью вызваны низкой производительностью SQL-запросов. Можно ускорить запросы SQL с помощью оптимизаторов запросов  

**Создать оптимальные индексы**   
При правильной индексации можно оптимизировать продолжительность выполнения запроса и повысить общую производительность базы данных. Индексы позволяют этого достичь путем внедрения структуры данных, которая помогает поддерживать порядок и облегчает поиск информации.
 
**Приобрести более мощный процессор**  

Чем лучше ваш процессор, тем быстрее и эффективнее будет ваша база данных. Поэтому, если ваша база данных работает не так, вы должны рассмотреть возможность обновления процессорного модуля более высокого класса; чем мощнее ваш процессор, тем меньше нагрузка при работе с несколькими приложениями и запросами. Кроме того, при оценке производительности ЦП важно отслеживать все аспекты производительности, в том числе время готовности ЦП (которое может рассказать вам о случаях, когда ваша система пыталась использовать ЦП, но не смогла, поскольку все ресурсы были слишком заняты).

**Выделите больше памяти** 

На эффективность базы данных наряду с недостатком мощности процессора влияет нехватка памяти. В конце концов, когда в базе данных недостаточно памяти для выполнения запрашиваемой работы, производительность базы данных идет на спад. По сути, наличие большего объема памяти поможет повысить общую производительность. Хороший способ проверить, нужно ли вам больше памяти — посмотреть сколько ошибок в вашей системе имеет страница. Если количество сбоев велико (например, в тысячах), это означает, что вашим хостам не хватает доступного пространства памяти. 

**Дефрагментация данных** 
Если у вас проблемы с медленной базой данных, возможным решением является дефрагментация данных. Когда в базу данных заносится много записей, они фрагментируются во внутренних файлах данных MySQL и на самом диске. Дефрагментация диска позволит сгруппировать соответствующие данные, поэтому операции, связанные с вводом/выводом, будут выполняться быстрее, что напрямую повлияет на общую производительность запросов и базы данных. Кроме того, на некотором связанном примечании также важно иметь достаточно дискового пространства.

**Типы дисков**  
Для извлечения результатов даже одного запроса могут потребоваться миллионы операций ввода-вывода с диска, в зависимости от объема данных, к которым запрос должен получить доступ для обработки, а также в зависимости от объема данных, возвращаемых из запроса. Таким образом, тип дисков на вашем сервере может сильно повлиять на производительность ваших SQL запросов. Работа с SSD-дисками может значительно повысить общую производительность базы данных и, в частности, производительность SQL-запросов.


**Версия базы данных**  
Другим важным фактором производительности базы данных является версия MySQL, которую вы в настоящее время развертываете. Обновление последней версии базы данных может существенно повлиять на общую производительность базы данных. Возможно, что один запрос может работать лучше в старых версиях MySQL, чем в новых, но если посмотреть на общую производительность, новые версии работают лучше.
